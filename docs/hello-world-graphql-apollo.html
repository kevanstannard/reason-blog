<!doctype html><html data-reactroot=""><head><title>Minimal Hello World using Apollo GraphQL and ReasonML</title><meta charSet="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet"/><link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/styles/default.min.css" rel="stylesheet"/><link href="static/styles.css" rel="stylesheet"/></head><body><div class="p-10"><p class="mb-4"><a class="hover:underline" href="index.html">← Back to index</a></p><h1 class="text-5xl font-black mb-4">Minimal Hello World using Apollo GraphQL and ReasonML</h1><p class="mb-12">Sun Dec 08 2019</p><div class="blogPostBody"><h2>Overview</h2>
<p>This is an absolutely bare-bones, minimal example application to demonstrate:</p>
<ul>
<li>Apollo GraphQL on the server.</li>
<li>ReasonML on the client.</li>
</ul>
<h2>Server code</h2>
<p>Our server code does the following:</p>
<ol>
<li>Accepts a GraphQL query “hello”, and</li>
<li>Responds with the text “World”.</li>
</ol>
<p>Create a <code>package.json</code> file.</p>
<pre><code>{
  &quot;name&quot;: &quot;hello-server&quot;,
  &quot;private&quot;: true
}
</code></pre>
<p>Install our dependencies:</p>
<pre><code>yarn add express
yarn add graphql
yarn add apollo-server
yarn add apollo-server-express
</code></pre>
<p>Create <code>src/index.js</code> for the server application.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);
<span class="hljs-keyword">const</span> { ApolloServer, gql } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;apollo-server-express&quot;</span>);

<span class="hljs-comment">// Declare the GraphQL types.</span>
<span class="hljs-comment">// Here, we support a query &quot;hello&quot; that returns a string.</span>
<span class="hljs-keyword">const</span> typeDefs = gql<span class="hljs-string">`
  type Query {
    hello: String!
  }
`</span>;

<span class="hljs-comment">// Declare a function to execute when we send the &quot;hello&quot; query.</span>
<span class="hljs-comment">// Here, we wait a couple of seconds and return the string &quot;World&quot;.</span>
<span class="hljs-keyword">const</span> helloQuery = <span class="hljs-function">() =&gt;</span>
  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      resolve(<span class="hljs-string">&quot;World&quot;</span>);
    }, <span class="hljs-number">2000</span>);
  });

<span class="hljs-comment">// Declare the GraphQL resolvers.</span>
<span class="hljs-comment">// These map queries to implementations.</span>
<span class="hljs-keyword">const</span> resolvers = {
  <span class="hljs-attr">Query</span>: {
    <span class="hljs-attr">hello</span>: helloQuery
  }
};

<span class="hljs-comment">// Create and start the server</span>
<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> ApolloServer({ typeDefs, resolvers });
<span class="hljs-keyword">const</span> app = express();
server.applyMiddleware({ app });

<span class="hljs-keyword">const</span> port = <span class="hljs-number">4000</span>;
app.listen({ port }, <span class="hljs-function">() =&gt;</span>
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Server ready at http://localhost:<span class="hljs-subst">${port}</span><span class="hljs-subst">${server.graphqlPath}</span>`</span>)
);
</code></pre>
<p>Add a script to <code>package.json</code> that starts the server.</p>
<pre><code>&quot;scripts&quot;: {
  &quot;start&quot;: &quot;node src/index&quot;
},
</code></pre>
<p>Start the server:</p>
<pre><code>yarn start
</code></pre>
<p>Test that the server is working, by browsing to <a href="http://localhost:4000/graphql">http://localhost:4000/graphql</a></p>
<p>Enter the following GraphQL query:</p>
<pre><code class="language-graphql">query {
  hello
}
</code></pre>
<p>You should see the response:</p>
<pre><code class="language-graphql">{
  &quot;data&quot;: {
    &quot;hello&quot;: &quot;World&quot;
  }
}
</code></pre>
<h2>Client</h2>
<p>Create a minimal package.json:</p>
<pre><code>{
  &quot;name&quot;: &quot;hello-client&quot;,
  &quot;private&quot;: true
}
</code></pre>
<p>Install our application dependencies:</p>
<pre><code>yarn add --exact react
yarn add --exact react-dom
yarn add --exact reason-apollo
yarn add --exact reason-react
</code></pre>
<p>Install our development dependencies:</p>
<pre><code>yarn add --exact bs-platform@5.2.1
yarn add --exact graphql_ppx
yarn add --exact html-webpack-plugin
yarn add --exact webpack
yarn add --exact webpack-cli
yarn add --exact webpack-dev-server
</code></pre>
<p><strong>Important: At the time of writing (December 2019) you must install bs-platform@5.2.1. <a href="https://github.com/apollographql/reason-apollo/issues/215">Later versions are not yet compatible with reason-apollo.</a></strong></p>
<p>Add some useful scripts to <code>package.json</code>:</p>
<pre><code>&quot;scripts&quot;: {
  &quot;re:build&quot;: &quot;bsb -make-world -clean-world&quot;,
  &quot;re:watch&quot;: &quot;bsb -make-world -clean-world -w&quot;,
  &quot;build&quot;: &quot;webpack&quot;,
  &quot;start&quot;: &quot;webpack-dev-server&quot;
},
</code></pre>
<p>Add a <code>bsconfig.json</code> file:</p>
<pre><code>{
  &quot;name&quot;: &quot;hello-client&quot;,
  &quot;reason&quot;: { &quot;react-jsx&quot;: 3 },
  &quot;bsc-flags&quot;: [&quot;-bs-super-errors&quot;],
  &quot;sources&quot;: [
    {
      &quot;dir&quot;: &quot;src&quot;,
      &quot;subdirs&quot;: true
    }
  ],
  &quot;package-specs&quot;: [
    {
      &quot;module&quot;: &quot;es6&quot;,
      &quot;in-source&quot;: true
    }
  ],
  &quot;suffix&quot;: &quot;.bs.js&quot;,
  &quot;namespace&quot;: true,
  &quot;bs-dependencies&quot;: [&quot;reason-react&quot;, &quot;reason-apollo&quot;],
  &quot;ppx-flags&quot;: [&quot;graphql_ppx/ppx&quot;],
  &quot;refmt&quot;: 3
}
</code></pre>
<p>Generate a GraphQL schema file for the client. This will generate a <code>graphql_schema.json</code> file.</p>
<pre><code>yarn send-introspection-query http://localhost:4000/graphql
</code></pre>
<p>The <code>graphql_schema.json</code> file contains the types for the queries that the server is handling. The reason-apollo package uses these types to ensure that our handling of the responses is type safe.</p>
<p>Add a <code>webpack.config.js</code> file:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;html-webpack-plugin&quot;</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);
<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;./src/Index.bs.js&quot;</span>,
  <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;development&quot;</span>,
  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> HtmlWebpackPlugin({ <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;templates/index.html&quot;</span> })],
  <span class="hljs-attr">devServer</span>: {
    <span class="hljs-attr">contentBase</span>: path.join(__dirname, <span class="hljs-string">&quot;build&quot;</span>),
    <span class="hljs-attr">port</span>: <span class="hljs-number">9000</span>
  }
};
</code></pre>
<p>Add a template for the application in <code>templates/index.html</code>:</p>
<pre><code class="language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello Client<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Create a <code>src/Index.re</code> file:</p>
<pre><code class="language-reasonml">ReactDOMRe.renderToElementWithId(
  &lt;ReasonApollo.Provider client=Client.instance&gt;
    &lt;App /&gt;
  &lt;/ReasonApollo.Provider&gt;,
  &quot;root&quot;,
);
</code></pre>
<p>Create a <code>src/Client.re</code> file:</p>
<pre><code class="language-reasonml"><span class="hljs-keyword">let</span> inMemoryCache = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ApolloInMemoryCache</span>.</span></span>create<span class="hljs-constructor">InMemoryCache()</span>;

<span class="hljs-keyword">let</span> httpLink =
  <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ApolloLinks</span>.</span></span>create<span class="hljs-constructor">HttpLink(~<span class="hljs-params">uri</span>=<span class="hljs-string">&quot;http://localhost:4000/graphql&quot;</span>, ()</span>);

<span class="hljs-keyword">let</span> instance =
  <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ReasonApollo</span>.</span></span>create<span class="hljs-constructor">ApolloClient(~<span class="hljs-params">link</span>=<span class="hljs-params">httpLink</span>, ~<span class="hljs-params">cache</span>=<span class="hljs-params">inMemoryCache</span>, ()</span>);
</code></pre>
<p>Create a <code>src/App.re</code> file:</p>
<pre><code class="language-reasonml"><span class="hljs-comment">/* Create a GraphQL Query by using the graphql_ppx */</span>
<span class="hljs-keyword">module</span> GetHello = <span class="hljs-literal">[%<span class="hljs-identifier">graphql</span> {|
  <span class="hljs-identifier">query</span> <span class="hljs-identifier">getHello</span> {
    <span class="hljs-identifier">hello</span>
  }
|}]</span>;

<span class="hljs-keyword">module</span> GetHelloQuery = ReasonApollo.<span class="hljs-constructor">CreateQuery(GetHello)</span>;

<span class="hljs-literal">[@<span class="hljs-identifier">react</span>.<span class="hljs-identifier">component</span>]</span>
<span class="hljs-keyword">let</span> make =<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
  &lt;GetHelloQuery&gt;
    ...{({result}) =&gt;
      switch (result) {
      <span class="hljs-pattern-match">| <span class="hljs-constructor">Loading</span> =&gt;</span>
        &lt;div&gt; {<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ReasonReact</span>.</span></span><span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Loading&quot;</span>)} &lt;/div&gt;
      <span class="hljs-pattern-match">| <span class="hljs-constructor">Error(<span class="hljs-params">error</span>)</span> =&gt;</span>
        &lt;div&gt; {<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ReasonReact</span>.</span></span><span class="hljs-built_in">string</span>(error##message)} &lt;/div&gt;
      <span class="hljs-pattern-match">| <span class="hljs-constructor">Data(<span class="hljs-params">response</span>)</span> =&gt;</span>
        &lt;div&gt;
          {<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ReasonReact</span>.</span></span><span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Hello&quot;</span>)}
          {<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ReasonReact</span>.</span></span><span class="hljs-built_in">string</span>(response##hello)}
        &lt;/div&gt;
      }
    }
  &lt;/GetHelloQuery&gt;;
};
</code></pre>
<p>Start the client application</p>
<pre><code>yarn start
</code></pre>
<p>You should then be able to browse to <a href="http://localhost:9000">http://localhost:9000</a></p>
<p>In the browser see:</p>
<pre><code>HelloWorld
</code></pre>
<h2>References</h2>
<p>ReasonApollo installation<br>
<a href="https://github.com/apollographql/reason-apollo">https://github.com/apollographql/reason-apollo</a></p>
<p>ReasonReact installation<br>
<a href="https://reasonml.github.io/reason-react/docs/en/installation.html">https://reasonml.github.io/reason-react/docs/en/installation.html</a></p>
</div></div></body></html>