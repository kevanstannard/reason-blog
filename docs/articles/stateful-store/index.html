<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Writing a simple stateful Redux store in ReasonML (without React) - Hello
    </title>
    <link rel="alternate" href="http://localhost:8080/feed.xml" type="application/rss+xml" title="ReasonML and Bucklescript">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="article-detail">
    <header class="header">
      <div class="content-wrap">
        <h1>Writing a simple stateful Redux store in ReasonML (without React)</h1>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <section class="content"><h2 id="creating-our-store">Creating our store</h2>
<p>Firstly, we need to create a stateful store that can be mutated by<span class="widont">&nbsp;</span>actions.</p>
<p>Let’s create a <code>Store.re</code> module and add a type for the<span class="widont">&nbsp;</span>store.</p>
<pre><code class="language-reasonml"><span class="keyword">type</span> t('action, 'state) = {
  <span class="keyword">mutable</span> state: 'state,
  reducer:<span class="function"> ('<span class="params">state</span>, '<span class="params">action</span>) =&gt;</span> 'state,
};</code></pre>
<p>This follows the naming convention <code>t</code> for a module. Also notice here that we’re using the <code>mutable</code> attribute for the<span class="widont">&nbsp;</span>state.</p>
<p>Next, add a function that creates the initial<span class="widont">&nbsp;</span>store.</p>
<pre><code class="language-reasonml"><span class="keyword">let</span> create =<span class="function"> (<span class="params">reducer</span>, <span class="params">initialState</span>): <span class="params">t</span>('<span class="params">action</span>, '<span class="params">state</span>) =&gt;</span> {
  state: initialState,
  reducer,
};</code></pre>
<p>Plus a function for dispatching actions. This mutates the state inside the<span class="widont">&nbsp;</span>store.</p>
<pre><code class="language-reasonml"><span class="keyword">let</span> dispatch = (store, action):<span class="function"> <span class="params">unit</span> =&gt;</span> {
  store.state = store.reducer(store.state, action);
};</code></pre>
<p>Lastly, let’s add a function for extracting the state from the<span class="widont">&nbsp;</span>store.</p>
<pre><code class="language-reasonml"><span class="keyword">let</span> getState = (store: t('action, 'state)): 'state =&gt; store.state;</code></pre>
<h2 id="using-the-store">Using the store</h2>
<p>Create an <code>Index.re</code> as our main application<span class="widont">&nbsp;</span>module.</p>
<p>Declare our types; we’ll create a simple increment/decrement<span class="widont">&nbsp;</span>behaviour.</p>
<pre><code class="language-reasonml"><span class="keyword">type</span> state = {counter: <span class="built_in">int</span>};

<span class="keyword">type</span> action =
  <span class="pattern-match">| <span class="constructor">Increment</span>
  | <span class="constructor">Decrement</span>;</span></code></pre>
<p>Next, create the reducer to process the<span class="widont">&nbsp;</span>actions.</p>
<pre><code class="language-reasonml"><span class="keyword">let</span> reducer =<span class="function"> (<span class="params">state</span>, <span class="params">action</span>) =&gt;</span> {
  switch (action) {
  <span class="pattern-match">| <span class="constructor">Increment</span> =&gt;</span> {counter: state.counter + <span class="number">1</span>}
  <span class="pattern-match">| <span class="constructor">Decrement</span> =&gt;</span> {counter: state.counter - <span class="number">1</span>}
  };
};</code></pre>
<p>Now, we can create our<span class="widont">&nbsp;</span>store.</p>
<pre><code class="language-reasonml"><span class="keyword">let</span> initalState = {counter: <span class="number">0</span>};

<span class="keyword">let</span> store = <span class="module-access"><span class="module"><span class="identifier">Store</span>.</span></span>create(reducer, initalState);</code></pre>
<p>Let’s also create two convenience functions that operate on the store we just<span class="widont">&nbsp;</span>created:</p>
<pre><code class="language-reasonml"><span class="keyword">let</span> dispatch =<span class="function"> <span class="params">action</span> =&gt;</span> <span class="module-access"><span class="module"><span class="identifier">Store</span>.</span></span>dispatch(store, action);

<span class="keyword">let</span> getState =<span class="function"> <span class="params">()</span> =&gt;</span> <span class="module-access"><span class="module"><span class="identifier">Store</span>.</span></span>get<span class="constructor">State(<span class="params">store</span>)</span>;</code></pre>
<p>And now we can write some code that uses the<span class="widont">&nbsp;</span>store:</p>
<pre><code class="language-reasonml"><span class="module-access"><span class="module"><span class="identifier">Js</span>.</span></span>log(<span class="module-access"><span class="module"><span class="identifier">CounterStore</span>.</span></span>get<span class="constructor">State()</span>);

<span class="module-access"><span class="module"><span class="identifier">CounterStore</span>.</span></span>dispatch(CounterStore.Increment);
<span class="module-access"><span class="module"><span class="identifier">Js</span>.</span></span>log(<span class="module-access"><span class="module"><span class="identifier">CounterStore</span>.</span></span>get<span class="constructor">State()</span>);

<span class="module-access"><span class="module"><span class="identifier">CounterStore</span>.</span></span>dispatch(CounterStore.Increment);
<span class="module-access"><span class="module"><span class="identifier">Js</span>.</span></span>log(<span class="module-access"><span class="module"><span class="identifier">CounterStore</span>.</span></span>get<span class="constructor">State()</span>);

<span class="module-access"><span class="module"><span class="identifier">CounterStore</span>.</span></span>dispatch(CounterStore.Decrement);
<span class="module-access"><span class="module"><span class="identifier">Js</span>.</span></span>log(<span class="module-access"><span class="module"><span class="identifier">CounterStore</span>.</span></span>get<span class="constructor">State()</span>);

<span class="module-access"><span class="module"><span class="identifier">CounterStore</span>.</span></span>dispatch(CounterStore.Decrement);
<span class="module-access"><span class="module"><span class="identifier">Js</span>.</span></span>log(<span class="module-access"><span class="module"><span class="identifier">CounterStore</span>.</span></span>get<span class="constructor">State()</span>);</code></pre>
<p>Which outputs:</p>
<pre><code class="language-bash">{ counter: 0 }
{ counter: 1 }
{ counter: 2 }
{ counter: 1 }
{ counter: 0 }</code></pre>
<h2 id="references">References</h2>
<p>Redux in Reason<br><a href="https://github.com/reasonml-community/reductive">https://github.com/reasonml-community/reductive</a></p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/">&laquo; Full blog</a></div>
        <section class="copy">
          <p>&copy; 2019 Kevan Stannard &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a></p>
        </section>
      </div>
    </footer>
  </body>
</html>