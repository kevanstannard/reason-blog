<!DOCTYPE HTML>
<html>
  <head>
    <title>Writing a simple stateful Redux store in ReasonML (without React)</title>
    <link rel="stylesheet" href="https://unpkg.com/picnic">
    <style>
      .container {
        padding: 1em 2em 4em 2em;
      }
      header h1 a {
        padding: 8px;
        color: #ffffff;
        background-color: #db4d3f;
      }
      .title {
        padding-bottom: 0;
      }
      .date {
        margin-top: 0;
        color: #888888;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>
          <a href="index.html">Hello ReasonML</a>
        </h1>
      </header>
      <article>
        <h1 class="title">Writing a simple stateful Redux store in ReasonML (without React)</h1>
        <p class="date">2019-12-12</p>
        <h2>Creating our store</h2>
<p>Firstly, we need to create a stateful store that can be mutated by actions.</p>
<p>Let’s create a <code>Store.re</code> module and add a type for the store.</p>
<pre><code class="language-reasonml">type t('action, 'state) = {
  mutable state: 'state,
  reducer: ('state, 'action) =&gt; 'state,
};
</code></pre>
<p>This follows the naming convention <code>t</code> for a module. Also notice here that we’re using the <code>mutable</code> attribute for the state.</p>
<p>Next, add a function that creates the initial store.</p>
<pre><code class="language-reasonml">let create = (reducer, initialState): t('action, 'state) =&gt; {
  state: initialState,
  reducer,
};
</code></pre>
<p>Plus a function for dispatching actions. This mutates the state inside the store.</p>
<pre><code class="language-reasonml">let dispatch = (store, action): unit =&gt; {
  store.state = store.reducer(store.state, action);
};
</code></pre>
<p>Lastly, let’s add a function for extracting the state from the store.</p>
<pre><code class="language-reasonml">let getState = (store: t('action, 'state)): 'state =&gt; store.state;
</code></pre>
<h2>Using the store</h2>
<p>Create an <code>Index.re</code> as our main application module.</p>
<p>Declare our types; we’ll create a simple increment/decrement behaviour.</p>
<pre><code class="language-reasonml">type state = {counter: int};

type action =
  | Increment
  | Decrement;
</code></pre>
<p>Next, create the reducer to process the actions.</p>
<pre><code class="language-reasonml">let reducer = (state, action) =&gt; {
  switch (action) {
  | Increment =&gt; {counter: state.counter + 1}
  | Decrement =&gt; {counter: state.counter - 1}
  };
};
</code></pre>
<p>Now, we can create our store.</p>
<pre><code class="language-reasonml">let initalState = {counter: 0};

let store = Store.create(reducer, initalState);
</code></pre>
<p>Let’s also create two convenience functions that operate on the store we just created:</p>
<pre><code class="language-reasonml">let dispatch = action =&gt; Store.dispatch(store, action);

let getState = () =&gt; Store.getState(store);
</code></pre>
<p>And now we can write some code that uses the store:</p>
<pre><code class="language-reasonml">Js.log(CounterStore.getState());

CounterStore.dispatch(CounterStore.Increment);
Js.log(CounterStore.getState());

CounterStore.dispatch(CounterStore.Increment);
Js.log(CounterStore.getState());

CounterStore.dispatch(CounterStore.Decrement);
Js.log(CounterStore.getState());

CounterStore.dispatch(CounterStore.Decrement);
Js.log(CounterStore.getState());
</code></pre>
<p>Which outputs:</p>
<pre><code class="language-bash">{ counter: 0 }
{ counter: 1 }
{ counter: 2 }
{ counter: 1 }
{ counter: 0 }
</code></pre>
<h2>References</h2>
<p>Redux in Reason<br>
https://github.com/reasonml-community/reductive</p>

      </article>
    </div>
  </body>
</html>